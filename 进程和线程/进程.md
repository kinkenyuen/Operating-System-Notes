# 进程

为了能使程序并发执行，并且可以对并发执行的程序加以描述和控制，引入了"进程"的概念

为了使多个并发执行的程序都能独立运行，操作系统使用**进程表**来管理这些进程

##  特征

* **动态性**：进程是动态的，程序是静态的
* **并发性**: 多个进程在同一时间内并发执行
* **独立性**：进程与进程之间相对独立，有自己独占的系统资源
* **异步性**：进程之间按异步方式运行，通常情况下互不干扰，各自以自己的顺序推进

## 进程表

操作系统对每个资源和每个进程都设置了一个数据结构，用于表征其实体，我们称之为**资源信息表**和**进程信息表**。

它们包含资源或进程的标识、描述、状态等信息以及大量指针

**通过指针，可以将同类资源或进程的信息表，或者同一进程所占用的资源信息表分类链接成不同的队列，以便操作系统查找**

操作系统管理的数据结构一般分为四类：**内存表、设备表、文件表和进程表**

进程表作用：

* 实现间断性运行方式，进程切换的时候保留CPU现场，进程恢复的时候根据保存的内容来进行恢复
* 提供进程管理所需要的信息，记录着该进程的程序和数据在内存或外存中的起止地址
* 提供进程调度所需要的信息，记录进程状态、优先级等等，在进程调度的时候使用
* 实现进程间的同步与通信

**进程表中含有多个进程控制块PCB，PCB为单个进程保存重要的信息**

# 进程控制

进程控制包括：

* 创建进程
* 终止已完成进程
* 处理异常进程
* 进程运行中的状态转换

**进程控制一般是由操作系统的内核中的原语来实现**

---

为了防止操作系统本身以及关键数据（如PCB）遭到有意无意破坏，通常将CPU执行状态分成**系统态和用户态**两种

* 系统态：又叫内核态，它具有较高的权限，能执行一切指令，访问所有寄存器和存储区，传统的操作系统都在系统态运行
* 用户态：权限较低，仅能执行规定的指令，访问指定的的寄存器和存储区

---

操作系统内核提供的支撑功能：

* **中断处理**：系统调用、键盘命令输入、进程调度、设备驱动等都需要中断
* **时钟管理**：时间片轮转调度等等
* **原语操作**：所谓原语，是由若干条指令组成的，用于完成一定功能的一个过程，它的一个重要特点是**"原子操作(Aciton Operation)"**。所谓原子操作是指，一个操作中的所有动作要么全做，要么全不做。原语在执行过程中不允许被中断。原子操作在内核态下执行，常驻内存

操作系统内核提供的资源管理功能：

* 进程管理
* 存储器管理
* 设备管理

# 进程同步

由于进程会并发执行，必然会出现多个进程对系统资源的无序争夺，造成系统混乱的情况。因此为了保证多个进程有条不紊运行，必须引入**进程同步机制**

同步机制应遵循的规则：

* **空闲让进**
* **忙则等待**
* **有限等待**：对要访问临界资源的进程，应保证在有限时间内能进入自己的临界区，以免陷入"死等"状态
* **让权等待**：当进程不能进入自己的临界区时，应立即释放处理机，以免进程陷入"忙等"状态

## 硬件同步机制

* **关中断**：缺点很多，一般不会用
* **使用Test-and-Set指令互斥**
* **Swap指令实现进程互斥(忙等)**
##  **信号量机制**
  * **整型信号量**
  * **记录型信号量**
* **管程机制**

> 设置进程的目的在于实现系统的并发性，而管程的设置则是解决共享资源的互斥使用问题

# 进程通信

信号量机制通信属于低级进程通信

在进程之间要传送大量数据时，应当利用OS提供的高级通信工具，该工具最主要的特点是：

1. 使用方便，OS隐藏实现细节，向用户提供实现高级通信的命令(原语)
2. 高效传送大量数据

## 类型

* **共享存储器**

  在内存中划分出一块共享存储区域，由程序员管理进程间的同步。**进程需要使用时，先向OS申请获得该共享区域的分区，并将其附加到自己的地址空间**

* **管道通信**

  用于连接一个读进程和写进程以实现它们之间通信的一个共享文件，又名pipe文件

  **管道必须互斥、同步、确定对方是否存在**

* **消息传递**

  最为广泛的一类进程间通信机制，是以格式化的消息为单位，将通信的数据封装在消息中，并利用操作系统提供的一组通信命令(原语)，在进程间进行消息传递，完成进程间的数据交换

* **客户机-服务器(client-server)**

  * socket (最初为了解决多对进程同时通信时端口和物理线路的多路复用。现在广泛用于网络通信程序接口)
  * 远程过程调用(RPC)

